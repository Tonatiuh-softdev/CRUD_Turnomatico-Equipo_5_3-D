{"version":3,"sources":["estadisticas.js"],"names":["canvas","document","getElementById","ctx","getContext","grafica","paletas","año","mes","dia","Chart","register","id","afterDraw","chart","chartArea","width","height","total","config","data","datasets","reduce","a","b","save","font","fillStyle","textAlign","fillText","restore","mostrarLoader","clearRect","obtenerDatos","periodo","fetch","response","ok","Error","json","console","error","crearGrafica","style","opacity","setTimeout","datos","cliente","find","d","tipo","visitante","etiquetas","valores","parseInt","textContent","colores","destroy","type","labels","backgroundColor","borderWidth","options","cutout","animation","animateScale","animateRotate","duration","easing","plugins","legend","display","tooltip","callbacks","label","context","raw","actualizarGrafica","addEventListener"],"mappings":"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","sourcesContent":["// ===========================\r\n//  CONFIGURACIÓN INICIAL\r\n// ===========================\r\nconst canvas = document.getElementById('grafica');\r\nconst ctx = canvas.getContext('2d');\r\n\r\nlet grafica;\r\n\r\n// Paletas de colores por periodo\r\nconst paletas = {\r\n    año: ['#7d6df6', '#ff7070'],\r\n    mes: ['#6dc8f6', '#ff9b9b'],\r\n    dia: ['#ffd766', '#ff8a8a']\r\n};\r\n\r\n// ===================================\r\n//  PLUGIN: TEXTO EN EL CENTRO\r\n// ===================================\r\nChart.register({\r\n    id: 'centerText',\r\n    afterDraw(chart) {\r\n        const { ctx, chartArea: { width, height } } = chart;\r\n        const total = chart.config.data.datasets[0].data.reduce((a, b) => a + b, 0);\r\n\r\n        ctx.save();\r\n        ctx.font = \"bold 22px Poppins\";\r\n        ctx.fillStyle = \"#444\";\r\n        ctx.textAlign = \"center\";\r\n        ctx.fillText(`${total} Turnos`, chart.width / 2, chart.height / 2 + 8);\r\n        ctx.restore();\r\n    }\r\n});\r\n\r\n// ===================================\r\n//  MINI-LOADER MIENTRAS CARGA DATOS\r\n// ===================================\r\nfunction mostrarLoader() {\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n    ctx.font = \"16px Poppins\";\r\n    ctx.fillStyle = \"#999\";\r\n    ctx.textAlign = \"center\";\r\n    ctx.fillText(\"Cargando...\", canvas.width / 2, canvas.height / 2);\r\n}\r\n\r\n// ===================================\r\n//  FUNCIÓN PARA OBTENER DATOS\r\n// ===================================\r\nasync function obtenerDatos(periodo = 'año') {\r\n    try {\r\n        const response = await fetch(`../PHP/datos_estadisticas.php?periodo=${periodo}`);\r\n        if (!response.ok) throw new Error(\"Error al obtener datos del servidor\");\r\n        return await response.json();\r\n    } catch (error) {\r\n        console.error(\"Error en obtenerDatos():\", error);\r\n        return [];\r\n    }\r\n}\r\n\r\n// ===================================\r\n//  CREAR / ACTUALIZAR GRÁFICA\r\n// ===================================\r\nasync function crearGrafica(periodo = 'año') {\r\n    // Fade-in bonito\r\n    canvas.style.opacity = 0;\r\n    setTimeout(() => canvas.style.opacity = 1, 300);\r\n\r\n    mostrarLoader();\r\n\r\n    const datos = await obtenerDatos(periodo);\r\n\r\n    const cliente = datos.find(d => d.tipo === 'CLIENTE') || { total: 0 };\r\n    const visitante = datos.find(d => d.tipo === 'VISITANTE') || { total: 0 };\r\n\r\n    const etiquetas = ['CLIENTE', 'VISITANTE'];\r\n    const valores = [parseInt(cliente.total), parseInt(visitante.total)];\r\n\r\n    // Actualizar textos informativos\r\n    document.getElementById('infoCliente').textContent = `${cliente.total} turnos`;\r\n    document.getElementById('infoVisitante').textContent = `${visitante.total} turnos`;\r\n\r\n    // Si no hay datos, mostrar mensaje y no crear gráfica\r\n    if (valores[0] === 0 && valores[1] === 0) {\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n        ctx.font = \"18px Poppins\";\r\n        ctx.fillStyle = \"#555\";\r\n        ctx.textAlign = \"center\";\r\n        ctx.fillText(\"Sin datos disponibles\", canvas.width / 2, canvas.height / 2);\r\n        return;\r\n    }\r\n\r\n    // Elegir paleta según el periodo\r\n    const colores = paletas[periodo] || paletas['año'];\r\n\r\n    if (grafica) grafica.destroy();\r\n\r\n    grafica = new Chart(ctx, {\r\n        type: 'doughnut',\r\n        data: {\r\n            labels: etiquetas,\r\n            datasets: [{\r\n                data: valores,\r\n                backgroundColor: colores,\r\n                borderWidth: 0\r\n            }]\r\n        },\r\n        options: {\r\n            cutout: '60%',\r\n            animation: {\r\n                animateScale: true,\r\n                animateRotate: true,\r\n                duration: 1200,\r\n                easing: 'easeOutQuart'\r\n            },\r\n            plugins: {\r\n                legend: { display: false },\r\n                tooltip: {\r\n                    callbacks: {\r\n                        label: (context) => `${context.label}: ${context.raw} turnos`\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\n// ===================================\r\n//  CAMBIAR PERIODO (BOTONES)\r\n// ===================================\r\nfunction actualizarGrafica(periodo) {\r\n    crearGrafica(periodo);\r\n}\r\n\r\n// ===================================\r\n//  CARGAR GRÁFICA INICIAL\r\n// ===================================\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n    crearGrafica();\r\n});\r\n"],"file":"estadisticas.dev.js"}