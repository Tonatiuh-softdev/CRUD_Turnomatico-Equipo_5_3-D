{"version":3,"sources":["estadisticas.js"],"names":["ctx","canvas","document","getElementById","getContext","paletas","año","mes","dia","mostrarLoader","clearRect","width","height","font","fillStyle","obtenerDatos","periodo","response","_args","arguments","regeneratorRuntime","async","_context","prev","next","length","undefined","awrap","fetch","concat","sent","ok","Error","json","abrupt","t0","console","error","stop","crearGrafica","datos","cliente","visitante","etiquetas","valores","colores","_args2","_context2","setTimeout","style","opacity","find","d","tipo","total","parseInt","textContent","textAlign","fillText","grafica","destroy","Chart","type","data","labels","datasets","backgroundColor","borderWidth","options","cutout","animation","animateScale","duration","easing","plugins","legend","display","callbacks","label","context","raw","actualizarGrafica","id","register","afterDraw","chart","chartArea","config","reduce","a","b","save"],"mappings":"aACA,IAGMA,QAHNC,OAAAC,SAAAC,eAAA,WACAH,IAAAC,OAAAG,WAAA,MAOMC,QAAU,CACZC,MAAM,CAAA,UAAW,WACjBC,IAAM,CAAA,UAAW,WACjBC,IAAM,CAAA,UAAW,YAuBrB,SAAAC,gBAEIT,IAAIU,UAAU,EAAG,EAAGT,OAAOU,MAAOV,OAAOW,QAD7CZ,IAAAa,KAASJ,eACLT,IAAIU,UAAJ,OACAV,IAAIa,UAAO,SACXb,IAAIc,SAAJ,cAAAb,OAAAU,MAAA,EAAAV,OAAAW,OAAA,GAQJ,SAAeG,eAAf,IAAAC,EAAAC,EAAAC,EAAAC,UAAA,OAAAC,mBAAAC,MAAA,SAAAC,GAAA,OAAA,OAAAA,EAAAC,KAAAD,EAAAE,MAAA,KAAA,EAAA,OAA4BR,EAA5B,EAAAE,EAAAO,aAAAC,IAAAR,EAAA,GAAAA,EAAA,GAAsC,MAAtCI,EAAAC,KAAA,EAAAD,EAAAE,KAAA,EAAAJ,mBAAAO,MAAAC,MAAA,yCAAAC,OAAAb,KAAA,KAAA,EAAA,IAAeD,EAAfO,EAAAQ,MAAAC,GAAA,CAAAT,EAAAE,KAAA,EAAA,MAAA,MAAA,IAAAQ,MAAA,uCAAA,KAAA,EAAA,OAAAV,EAAAE,KAAA,EAAAJ,mBAAAO,MAAAV,EAAAgB,QAAA,KAAA,EAAA,OAAAX,EAAAY,OAAA,SAAAZ,EAAAQ,MAAA,KAAA,GAAA,OAAAR,EAAAC,KAAA,GAAAD,EAAAa,GAAAb,EAAA,MAAA,GAAAc,QAAAC,MAAA,2BAAAf,EAAAa,IAAAb,EAAAY,OAAA,SAAA,IAAA,KAAA,GAAA,IAAA,MAAA,OAAAZ,EAAAgB,SAAA,KAAA,KAAA,CAAA,CAAA,EAAA,MAcA,SAAeC,eAAf,IAAAvB,EAAAwB,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA3B,UAAA,OAAAC,mBAAAC,MAAA,SAAA0B,GAAA,OAAA,OAAAA,EAAAxB,KAAAwB,EAAAvB,MAAA,KAAA,EAAA,OAA4BR,EAA5B,EAAA8B,EAAArB,aAAAC,IAAAoB,EAAA,GAAAA,EAAA,GAAsC,MAZxB7B,OAAAA,MAAAA,QAFd,EAiBI+B,WAAW,WAAA,OAAM/C,OAAOgD,MAAMC,QAAU,GAAG,KAjB/CzC,gBAcAsC,EAAAvB,KAAA,EAAAJ,mBAAAO,MAdAZ,aAAAC,IAcA,KAAA,EAAA,GAdAwB,EAcAO,EAAAjB,KAdAW,EAGoCT,EAAMmB,KAAA,SAAAC,GAAA,MAAA,YAAAA,EAAAC,QAAA,CAAVC,MAHhC,GAwBUZ,EAAYF,EAAMW,KAAK,SAAAC,GAAC,MAAe,cAAXA,EAAEC,QAAyB,CAAEC,MAAO,GAxB1EX,EAAA,CAAA,UAAA,aAAAC,EAAA,CAAAW,SAAAd,EAAAa,OAIqBrC,SAAAyB,EAJrBY,QAAApD,SAAAC,eAAA,eAAAqD,YAAA,GAAA3B,OAAAY,EAAAa,MAAA,WA+BIpD,SAASC,eAAe,iBAAiBqD,YAAzC,GAAA3B,OAA0Da,EAAUY,MAApE,WA/BJ,IAAAV,EAAA,IAAA,IAAAA,EAAA,GAcA,OARQR,IAAAA,UAAQC,EAAM,EAAApC,OAAAU,MAAAV,OAAAW,QANtBZ,IAAAa,KAAA,eAqCQb,IAAIc,UAAY,OArCxBd,IAAAyD,UAAA,SAAAzD,IAAA0D,SAAA,wBAAAzD,OAAAU,MAAA,EAAAV,OAAAW,OAAA,GAcAmC,EAAAb,OAAA,UAAAa,EAAAvB,KAAA,GAAA,MAAA,KAAA,GAHAqB,EAAAxC,QAAAW,IAAAX,QAAA,OAEAsD,SAAAA,QAAAC,UAmCID,QAAU,IAAIE,MAAM7D,IAAK,CAlC7B8D,KAAevB,WAAfwB,KAAA,CAAAC,OAAArB,EAAAsB,SAAA,CAAA,CAAAF,KAAAnB,EAAAsB,gBAAArB,EAAAsB,YAAA,KAAAC,QAAA,CAAAC,OAAA,MAAAC,UAAA,CAAAC,cAAA,EAA4BvD,eAA5B,EACIwD,SAAA,KACMC,OAAOvB,gBACFwB,QAAMzE,CAAP0E,OAAV,CAAAC,SAAA,GAEAnE,QAAa,CALjBoE,UAAA,CAAAC,MAAA,SAAAC,GAAA,MAAA,GAAAlD,OAOwBd,EAAaC,MAPrC,MAAAa,OAAAkD,EAAAC,IAAA,kBAAA,KAAA,GAAA,IAAA,MAAA,OAAAjC,EAAAT,UAUkC,SAAA2C,kBAA+BjE,GAAEsC,aAAKtC,GApDpEkE,MAAIC,SAAA,CACJC,GAAAA,aAAiBA,UADb,SAE8CC,GAAtCrF,IADKA,EAAAqF,EAAArF,IACLA,EADKqF,EAAAC,UAAAhC,GACLtD,EAAKsF,MAALtF,EAAKsF,OADAD,EAAAE,OACa5E,KADbsD,SAAA,GAAAF,KAAAyB,OAAA,SAAAC,EAAAC,GAAA,OAAAD,EAAAC,GAAA,IAEPpC,EAAAA,OAAkDtD,EAAAa,KAAA,oBAA1Cb,EAAdc,UAAA,OAEI6E,EAAJlC,UAAA,SACI5C,EAAJ6C,SAAI7C,GAAAA,OAAOyC,EAAPzC,WAAJwE,EAAA1E,MAAA,EAAA0E,EAAAzE,OAAA,EAAA,GACIE,EAAAA,aAoDRZ,SAAAA,iBAASC,mBAAe,WA0DxBoC","file":"estadisticas.min.js","sourcesContent":["// ===========================\r\n//  CONFIGURACIÓN INICIAL\r\n// ===========================\r\nconst canvas = document.getElementById('grafica');\r\nconst ctx = canvas.getContext('2d');\r\n\r\nlet grafica;\r\n\r\n// Paletas de colores por periodo\r\nconst paletas = {\r\n    año: ['#7d6df6', '#ff7070'],\r\n    mes: ['#6dc8f6', '#ff9b9b'],\r\n    dia: ['#ffd766', '#ff8a8a']\r\n};\r\n\r\n// ===================================\r\n//  PLUGIN: TEXTO EN EL CENTRO\r\n// ===================================\r\nChart.register({\r\n    id: 'centerText',\r\n    afterDraw(chart) {\r\n        const { ctx, chartArea: { width, height } } = chart;\r\n        const total = chart.config.data.datasets[0].data.reduce((a, b) => a + b, 0);\r\n\r\n        ctx.save();\r\n        ctx.font = \"bold 22px Poppins\";\r\n        ctx.fillStyle = \"#444\";\r\n        ctx.textAlign = \"center\";\r\n        ctx.fillText(`${total} Turnos`, chart.width / 2, chart.height / 2 + 8);\r\n        ctx.restore();\r\n    }\r\n});\r\n\r\n// ===================================\r\n//  MINI-LOADER MIENTRAS CARGA DATOS\r\n// ===================================\r\nfunction mostrarLoader() {\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n    ctx.font = \"16px Poppins\";\r\n    ctx.fillStyle = \"#999\";\r\n    ctx.textAlign = \"center\";\r\n    ctx.fillText(\"Cargando...\", canvas.width / 2, canvas.height / 2);\r\n}\r\n\r\n// ===================================\r\n//  FUNCIÓN PARA OBTENER DATOS\r\n// ===================================\r\nasync function obtenerDatos(periodo = 'año') {\r\n    try {\r\n        const response = await fetch(`../PHP/datos_estadisticas.php?periodo=${periodo}`);\r\n        if (!response.ok) throw new Error(\"Error al obtener datos del servidor\");\r\n        return await response.json();\r\n    } catch (error) {\r\n        console.error(\"Error en obtenerDatos():\", error);\r\n        return [];\r\n    }\r\n}\r\n\r\n// ===================================\r\n//  CREAR / ACTUALIZAR GRÁFICA\r\n// ===================================\r\nasync function crearGrafica(periodo = 'año') {\r\n    // Fade-in bonito\r\n    canvas.style.opacity = 0;\r\n    setTimeout(() => canvas.style.opacity = 1, 300);\r\n\r\n    mostrarLoader();\r\n\r\n    const datos = await obtenerDatos(periodo);\r\n\r\n    const cliente = datos.find(d => d.tipo === 'CLIENTE') || { total: 0 };\r\n    const visitante = datos.find(d => d.tipo === 'VISITANTE') || { total: 0 };\r\n\r\n    const etiquetas = ['CLIENTE', 'VISITANTE'];\r\n    const valores = [parseInt(cliente.total), parseInt(visitante.total)];\r\n\r\n    // Actualizar textos informativos\r\n    document.getElementById('infoCliente').textContent = `${cliente.total} turnos`;\r\n    document.getElementById('infoVisitante').textContent = `${visitante.total} turnos`;\r\n\r\n    // Si no hay datos, mostrar mensaje y no crear gráfica\r\n    if (valores[0] === 0 && valores[1] === 0) {\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n        ctx.font = \"18px Poppins\";\r\n        ctx.fillStyle = \"#555\";\r\n        ctx.textAlign = \"center\";\r\n        ctx.fillText(\"Sin datos disponibles\", canvas.width / 2, canvas.height / 2);\r\n        return;\r\n    }\r\n\r\n    // Elegir paleta según el periodo\r\n    const colores = paletas[periodo] || paletas['año'];\r\n\r\n    if (grafica) grafica.destroy();\r\n\r\n    grafica = new Chart(ctx, {\r\n        type: 'doughnut',\r\n        data: {\r\n            labels: etiquetas,\r\n            datasets: [{\r\n                data: valores,\r\n                backgroundColor: colores,\r\n                borderWidth: 0\r\n            }]\r\n        },\r\n        options: {\r\n            cutout: '60%',\r\n            animation: {\r\n                animateScale: true,\r\n                animateRotate: true,\r\n                duration: 1200,\r\n                easing: 'easeOutQuart'\r\n            },\r\n            plugins: {\r\n                legend: { display: false },\r\n                tooltip: {\r\n                    callbacks: {\r\n                        label: (context) => `${context.label}: ${context.raw} turnos`\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\n// ===================================\r\n//  CAMBIAR PERIODO (BOTONES)\r\n// ===================================\r\nfunction actualizarGrafica(periodo) {\r\n    crearGrafica(periodo);\r\n}\r\n\r\n// ===================================\r\n//  CARGAR GRÁFICA INICIAL\r\n// ===================================\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n    crearGrafica();\r\n});\r\n"]}