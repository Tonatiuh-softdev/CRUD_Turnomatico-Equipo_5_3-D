
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NEXORA - Cajas</title>
<link rel="stylesheet" href="../CSS/servicios.css">
</head>
<body>

<?php loadheader(); ?>

<div class="container">
    <?php loadNavbar(); ?>

<main>
    <h2>üñ•Ô∏è Administrar Cajas</h2>
    <div style="display: flex; justify-content: space-between; align-items: center; gap: 20px; margin: 20px 0;">
        <!-- Barra de b√∫squeda -->
        <div style="max-width: 300px;">
            <?php include __DIR__ . '/../Componentes/HTML/BarraBusqueda.html'; ?>
        </div>
    </div>

    

    <!-- Bot√≥n para abrir modal agregar -->
    <button class="btn-agregar" onclick="abrirModal()">+ Agregar Caja</button>

    <!-- Modal -->
    <div id="modalCaja" class="modal">
      <div class="modal-contenido">
        <h3>Agregar Caja</h3>
        <form method="POST">
          <input type="number" name="numeroCaja" placeholder="N√∫mero de caja" required>

          <select name="estadoCaja" required>
              <option value="Disponible">Disponible</option>
              <option value="Ocupada">Ocupada</option>
              <option value="Fuera de servicio">Fuera de servicio</option>
          </select>

          <select name="servicioCaja">
              <option value="">Sin servicio asignado</option>
              <?php while($s = $servicios->fetch_assoc()): ?>
              <option value="<?= $s['ID_Servicio'] ?>"><?= htmlspecialchars($s['Nombre']) ?></option>
              <?php endwhile; ?>
          </select>

          <button type="submit">Agregar</button>
        </form>
        <button class="cerrar" onclick="cerrarModal()">Cerrar</button>
      </div>
    </div>

    <!-- Tabla cajas -->
    <table>
        <thead>
            <tr>
                <th data-translate="">ID</th>
                <th data-translate="Numero">Numero</th>
                <th data-translate="Estado">Estado</th>
                <th data-translate="Servicio">Servicio</th>
                <th data-translate="Editar">Editar</th>
                <th data-translate="Eliminar">Eliminar</th>
            </tr>
        </thead>

        <tbody>
            <?php while ($row = $result->fetch_assoc()): ?>
            <tr>
                <td><?= $row['ID_Caja'] ?></td>
                <td><?= $row['Numero_Caja'] ?></td>
                <td><?= $row['Estado'] ?></td>
                <td><?= htmlspecialchars($row['NombreServ'] ?? 'Sin asignar') ?></td>

                <td>
                    <form method="POST">
                        <input type="hidden" name="editar_id" value="<?= $row['ID_Caja'] ?>">

                        <input type="number" name="editar_numero" value="<?= $row['Numero_Caja'] ?>" required>

                        <select name="editar_estado">
                            <option <?= ($row['Estado']=="Disponible"?"selected":"") ?>>Disponible</option>
                            <option <?= ($row['Estado']=="Ocupada"?"selected":"") ?>>Ocupada</option>
                            <option <?= ($row['Estado']=="Fuera de servicio"?"selected":"") ?>>Fuera de servicio</option>
                        </select>

                        <select name="editar_servicio">
                            <option value="">Sin asignar</option>
                            <?php $servicios2 = $conn->query("SELECT * FROM Servicio");
                            while($s2 = $servicios2->fetch_assoc()): ?>
                                <option value="<?= $s2['ID_Servicio'] ?>" 
                                    <?= ($row['ID_Servicio']==$s2['ID_Servicio']?"selected":"") ?>>
                                    <?= htmlspecialchars($s2['Nombre']) ?>
                                </option>
                            <?php endwhile; ?>
                        </select>

                        <button type="submit">Guardar</button>
                    </form>
                </td>

                <td>
                    <form method="POST" onsubmit="return confirm('¬øSeguro que quieres eliminar esta caja?');">
                        <input type="hidden" name="eliminar_id" value="<?= $row['ID_Caja'] ?>">
                        <button type="submit">Eliminar</button>
                    </form>
                </td>

            </tr>
            <?php endwhile; ?>
        </tbody>
    </table>

</main>
</div>
<script src="../JS/cajas.js"></script>
</body>
</html>