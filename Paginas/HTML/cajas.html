
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NEXORA - Cajas</title>
<link rel="stylesheet" href="../CSS/cajas.css">
</head>
<body>

<?php loadheader(); ?>

<div class="container">
    <?php loadNavbar(); ?>

<main>
    <h2> Administrar Cajas</h2>
    
    <?php if ($error_mensaje): ?>
        <div class="error-message" style="background-color: #f8d7da; color: #721c24; padding: 12px; border-radius: 4px; margin: 15px 0; border: 1px solid #f5c6cb;">
            <?= htmlspecialchars($error_mensaje) ?>
        </div>
    <?php endif; ?>
    <div style="display: flex; justify-content: space-between; align-items: center; gap: 20px; margin-bottom: -10px;">
        <!-- Barra de búsqueda -->
        <div style="max-width: 300px;">
            <?php include __DIR__ . '/../Componentes/HTML/BarraBusqueda.html'; ?>
        </div>

        <!-- Botón grande para abrir modal -->
        <button class="btn-agregar" onclick="abrirModal()">+ Agregar Caja</button>
    </div>
    <!-- Modal Agregar -->
    <div id="modalCaja" class="modal">
      <div class="modal-contenido">
        <h3>Agregar Caja</h3>
        <form method="POST">
          <input type="text" name="numeroCaja" placeholder="Número de caja" required>

          <select name="estadoCaja" required>
              <option value="Disponible">Disponible</option>
              <option value="Ocupada">Ocupada</option>
              <option value="Fuera de servicio">Fuera de servicio</option>
          </select>

          <select name="idServicio" required>
              <option value="">Seleccionar servicio</option>
              <?php while($s = $servicios->fetch_assoc()): ?>
              <option value="<?= $s['ID_Servicio'] ?>"><?= htmlspecialchars($s['Nombre']) ?></option>
              <?php endwhile; ?>
          </select>

          <button type="submit">Agregar</button>
        </form>
        <button class="cerrar" onclick="cerrarModal()">Cerrar</button>
      </div>
    </div>
<!-- Modal Editar -->
<div id="editarCajaModal" class="modal">
  <div class="modal-contenido">
    <h3>Editar Caja</h3>
    <form id="formEditarCaja" method="POST">
      <input type="hidden" name="editar_id" id="editar_id">

      <label for="editar_numero">Número de caja</label>
      <input type="text" name="editar_numero" id="editar_numero" required>

      <div class="grupo-opciones">
        <div class="campo">
          <label for="editar_estado">Estado</label>
          <select name="editar_estado" id="editar_estado" required>
              <option value="Disponible">Disponible</option>
              <option value="Ocupada">Ocupada</option>
              <option value="Fuera de servicio">Fuera de servicio</option>
          </select>
        </div>

        <div class="campo">
          <label for="editar_servicio">Servicio</label>
          <select name="editar_servicio" id="editar_servicio" required>
              <option value="">Seleccionar servicio</option>
              <?php 
              // Resetear el puntero de resultado a la primera posición
              $servicios->data_seek(0);
              while($s = $servicios->fetch_assoc()): ?>
              <option value="<?= $s['ID_Servicio'] ?>"><?= htmlspecialchars($s['Nombre']) ?></option>
              <?php endwhile; ?>
          </select>
        </div>
      </div>

      <button type="submit" class="btn-guardar">Guardar cambios</button>
    </form>

    <button class="cerrar" onclick="cerrarEditarModal()">Cerrar</button>
  </div>
</div>


    <!-- Tabla cajas -->
    <table id="tablaCajas">
        <thead>
            <tr>
                <th data-translate="Codigo">Codigo</th>
                <th data-translate="Estado">Estado</th>
                <th data-translate="Servicio">Servicio</th>
                <th data-translate="Editar">Editar</th>
                <th data-translate="Eliminar">Eliminar</th>
            </tr>
        </thead>
        <tbody>
            <?php while ($row = $result->fetch_assoc()): ?>
            <tr>
                <td data-label="Número"><?= $row['Numero_Caja'] ?></td>
                <td data-label="Estado" data-estado="<?= $row['Estado'] ?>"><?= $row['Estado'] ?></td>
                <td data-label="Servicio"><?= htmlspecialchars($row['ServicioNombre'] ?? 'Sin asignar') ?></td>
                <td data-label="Editar">
                    
    <button class="btn-editar"
        data-id="<?= $row['ID_Caja'] ?>"
        data-numero="<?= htmlspecialchars($row['Numero_Caja'], ENT_QUOTES) ?>"
        data-estado="<?= htmlspecialchars($row['Estado'], ENT_QUOTES) ?>"
        data-servicio="<?= htmlspecialchars($row['ServicioNombre'] ?? '', ENT_QUOTES) ?>">
        <span class="btn-editar__icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M12 20h9" />
                <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z" />
            </svg>
        </span>
    </button>
</td>

                <td>
                    <form method="POST" onsubmit="return confirm('¿Seguro que quieres eliminar esta caja?');">
    <input type="hidden" name="eliminar_id" value="<?= $row['ID_Caja'] ?>">
    <button class="btn-eliminar" type="submit" name="eliminar" value="1">
        <span class="btn-eliminar__icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6"></path>
            </svg>
        </span>
    </button>
</form>


                </td>
            </tr>
            <?php endwhile; ?>
        </tbody>
    </table>

</main>
</div>
<script src="../JS/cajas.js"></script>
</body>
</html>
