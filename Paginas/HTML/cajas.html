
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NEXORA - Cajas</title>
<link rel="stylesheet" href="../CSS/servicios.css">
</head>
<body>

<?php loadheader(); ?>

<div class="container">
    <?php loadNavbar(); ?>

<main>
    <h2>üñ•Ô∏è Administrar Cajas</h2>
    <div style="display: flex; justify-content: space-between; align-items: center; gap: 20px; margin: 20px 0;">
        <!-- Barra de b√∫squeda -->
        <div style="max-width: 300px;">
            <?php include __DIR__ . '/../Componentes/HTML/BarraBusqueda.html'; ?>
        </div>
    </div>

    <!-- Bot√≥n para abrir modal agregar -->
    <button class="btn-agregar" onclick="abrirModal()">+ Agregar Caja</button>

    <!-- Modal Agregar -->
    <div id="modalCaja" class="modal">
      <div class="modal-contenido">
        <h3>Agregar Caja</h3>
        <form method="POST">
          <input type="number" name="numeroCaja" placeholder="N√∫mero de caja" required>

          <select name="estadoCaja" required>
              <option value="Disponible">Disponible</option>
              <option value="Ocupada">Ocupada</option>
              <option value="Fuera de servicio">Fuera de servicio</option>
          </select>

          <select name="idServicio">
              <option value="">Sin servicio asignado</option>
              <?php while($s = $servicios->fetch_assoc()): ?>
              <option value="<?= $s['ID_Servicio'] ?>"><?= htmlspecialchars($s['Nombre']) ?></option>
              <?php endwhile; ?>
          </select>

          <button type="submit">Agregar</button>
        </form>
        <button class="cerrar" onclick="cerrarModal()">Cerrar</button>
      </div>
    </div>
<!-- Modal Editar -->
<div id="editarCajaModal" class="modal">
  <div class="modal-contenido">
    <h3>Editar Caja</h3>
    <form id="formEditarCaja" method="POST">
      <input type="hidden" name="editar_id" id="editar_id">

      <label for="editar_numero">N√∫mero de caja</label>
      <input type="number" name="editar_numero" id="editar_numero" required>

      <div class="grupo-opciones">
        <div class="campo">
          <label for="editar_estado">Estado</label>
          <select name="editar_estado" id="editar_estado" required>
              <option value="Disponible">Disponible</option>
              <option value="Ocupada">Ocupada</option>
              <option value="Fuera de servicio">Fuera de servicio</option>
          </select>
        </div>

        <div class="campo">
          <label for="editar_servicio">Servicio</label>
          <select name="editar_servicio" id="editar_servicio">
              <option value="">Sin asignar</option>
              <?php 
              $serviciosEdit = $conn->query("SELECT ID_Servicio, Nombre FROM Servicio ORDER BY Nombre ASC");
              while($s = $serviciosEdit->fetch_assoc()): ?>
              <option value="<?= $s['ID_Servicio'] ?>"><?= htmlspecialchars($s['Nombre']) ?></option>
              <?php endwhile; ?>
          </select>
        </div>
      </div>

      <button type="submit" class="btn-guardar">Guardar cambios</button>
    </form>

    <button class="cerrar" onclick="cerrarEditarModal()">Cerrar</button>
  </div>
</div>


    <!-- Tabla cajas -->
    <table id="tablaCajas">
        <thead>
            <tr>
                <th data-translate="">ID</th>
                <th data-translate="Numero">Numero</th>
                <th data-translate="Estado">Estado</th>
                <th data-translate="Servicio">Servicio</th>
                <th data-translate="Editar">Editar</th>
                <th data-translate="Eliminar">Eliminar</th>
            </tr>
        </thead>
        <tbody>
            <?php while ($row = $result->fetch_assoc()): ?>
            <tr>
                <td><?= $row['ID_Caja'] ?></td>
                <td><?= $row['Numero_Caja'] ?></td>
                <td><?= $row['Estado'] ?></td>
                <td><?= htmlspecialchars($row['ServicioNombre'] ?? 'Sin asignar') ?></td>

                <td>
                    <button class="btn-editar"
                        data-id="<?= $row['ID_Caja'] ?>"
                        data-numero="<?= htmlspecialchars($row['Numero_Caja'], ENT_QUOTES) ?>"
                        data-estado="<?= htmlspecialchars($row['Estado'], ENT_QUOTES) ?>"
                        data-servicio="<?= htmlspecialchars($row['ServicioNombre'] ?? '', ENT_QUOTES) ?>">
                        Editar
                    </button>
                </td>

                <td>
                    <form method="POST" onsubmit="return confirm('¬øSeguro que quieres eliminar esta caja?');">
                        <input type="hidden" name="eliminar_id" value="<?= $row['ID_Caja'] ?>">
                        <button type="submit">Eliminar</button>
                    </form>
                </td>
            </tr>
            <?php endwhile; ?>
        </tbody>
    </table>

</main>
</div>
<script src="../JS/cajas.js"></script>
</body>
</html>
