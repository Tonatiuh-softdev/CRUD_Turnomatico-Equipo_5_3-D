<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NEXORA - Clientes</title>
<link rel="stylesheet" href="../CSS/clientes.css">

</head>
<body>

<?php

loadHeader();
?>
<div class="container">

<?php


loadNavbar();
?>
<main>
    <h2>Administrar Clientes</h2>

    <div style="display: flex; justify-content: space-between; align-items: center; gap: 20px; margin-bottom: -10px;">
        <!-- Barra de búsqueda -->
        <div style="max-width: 300px;">
            <?php include __DIR__ . '/../Componentes/HTML/BarraBusqueda.html'; ?>
        </div>

        <!-- Botón grande para abrir modal -->
        <button class="btn-agregar" onclick="abrirModalCliente()">➕ Agregar Cliente</button>
    </div>

    <!-- Modal agregar cliente -->
    <div id="modalCliente" class="modal">
        <div class="modal-contenido">
            <h3>Agregar Cliente</h3>
            <form method="POST">
                <input type="text" name="nombreCliente" placeholder="Nombre del cliente" required>
                <button type="submit">Agregar</button>
            </form>
            <button class="cerrar" onclick="cerrarModalCliente()">Cerrar</button>
        </div>
    </div>

    <!-- Tabla clientes -->
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Cliente</th>
                <th>Email</th>
                <th>Status</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
        <?php
            $sql = "SELECT id, nombre, email, status FROM usuarios WHERE rol='cliente' ORDER BY id ASC";
            $result = $conn->query($sql);
            if ($result && $result->num_rows > 0) {
                while($row = $result->fetch_assoc()) {
                    echo "<tr>
                        <td>{$row['id']}</td>
                        <td>{$row['nombre']}</td>
                        <td>{$row['email']}</td>
                        <td>
                            <form method='POST'>
                                <input type='hidden' name='cambiar_status_id' value='{$row['id']}'>
                                <input type='hidden' name='nuevo_status' value='{$row['status']}'>
                                <button type='submit' class='btn-status'>{$row['status']}</button>
                            </form>
                        </td>
                        <td>
                            <form method='POST' style='display:inline'>
                                <input type='hidden' name='eliminar_id' value='{$row['id']}'>
                                <button type='submit' class='btn-eliminar'>Eliminar</button>
                            </form>
                        </td>
                    </tr>";
                }
            } else {
                echo "<tr><td colspan='5'>No hay clientes registrados</td></tr>";
            }
        ?>
        </tbody>
    </table>
</main>
</div>

<script>
// Abrir y cerrar modal
const modalCliente = document.getElementById("modalCliente");
function abrirModalCliente(){ modalCliente.style.display = "flex"; }
function cerrarModalCliente(){ modalCliente.style.display = "none"; }
// Cerrar modal al hacer clic fuera del contenido
window.addEventListener("click", function(e){
    if(e.target === modalCliente) cerrarModalCliente();
});

// Filtrar tabla de clientes en tiempo real
document.addEventListener('DOMContentLoaded', function(){
    const input = document.querySelector('.InputContainer .input');
    const tabla = document.querySelector('table tbody');
    
    if(!input || !tabla) return;
    
    input.addEventListener('input', function(){
        const searchTerm = this.value.toLowerCase().trim();
        const filas = tabla.querySelectorAll('tr');
        
        filas.forEach(fila => {
            const textoFila = fila.textContent.toLowerCase();
            if(searchTerm === '' || textoFila.includes(searchTerm)){
                fila.style.display = '';
            } else {
                fila.style.display = 'none';
            }
        });
    });
});
</script>
</body>
</html>
